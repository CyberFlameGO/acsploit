import os

from options import Options


options = Options()
options.add_option('depth', 10, 'Recursive depth/width of Git bomb', [10, 20, 30, 40, 50])

DESCRIPTION = 'Produces a tar.gz of a Git bomb (see Kate Murphy\'s work at https://kate.io/blog/git-bomb/)'


def run(generator, output):
    if output.OUTPUT_NAME != 'file' or output.options['format'] != 'binary' or output.options['final_newline']:
        raise ValueError('Output must be file with binary type and no final newline')
    ret = git_bomb(options['depth'])
    output.output([ret])


# Returns a git bomb based on https://github.com/Katee/git-bomb#readme
def git_bomb(depth):
    filename = 'gitbomb' + str(depth) + '.tar.gz'
    with open(os.path.join(os.path.dirname(os.path.realpath(__file__)), 'git_bombs', filename), 'rb') as git_bomb_file:
        return git_bomb_file.read()
