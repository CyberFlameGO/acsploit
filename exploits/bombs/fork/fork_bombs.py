from options import Options
import os

options = Options()
options.add_option('file_format', "sh", 'Format for fork bomb', ['bash', 'bat', 'c', 'cc', 'cs', 'erl', 'fasm', 'go',
                                                                 'hs', 'html', 'java', 'js', 'lsp', 'lua', 'mdb', 'php',
                                                                 'pl', 'py', 'r', 'rb', 'rs', 's', 'scm', 'sh', 'vbs'])

DESCRIPTION = 'Produces a fork bomb in one of many formats'


def run(generator, output):
    if output.OUTPUT_NAME not in ["file", "stdout", "network"]:
        raise ValueError("Unsupported output type for file bomb")
    ret = fork_bomb(options['file_format'])
    output.output([ret])


# Returns contents of fork bomb with the given format. Fork bombs found at https://github.com/aaronryank/fork-bomb/
def fork_bomb(file_format):
    filename = "fork-bomb." + file_format
    with open(os.path.dirname(os.path.realpath(__file__)) + "/fork_bombs/" + filename, 'r') as fork_bomb_file:
        return fork_bomb_file.read()
